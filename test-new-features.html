<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test New Features - Supernova Comment Monitor</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .test-result { margin: 10px 0; padding: 10px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { margin: 5px; padding: 8px 16px; }
        .feature-demo { background: #f8f9fa; padding: 10px; margin: 10px 0; border-left: 4px solid #007bff; }
    </style>
</head>
<body>
    <h1>Test New Features - Supernova Comment Monitor</h1>
    
    <div class="test-section">
        <h2>🔗 1. Clickable Links to Original Posts/Comments</h2>
        <p>Comments now include direct links to view original posts and comments on Facebook/Instagram/YouTube</p>
        <button onclick="testCommentLinks()">Test Comment Links Feature</button>
        <div id="links-test-result"></div>
        <div class="feature-demo">
            <strong>New Features:</strong>
            <ul>
                <li>🔗 External link icon next to comments - links directly to the comment</li>
                <li>📄 Post link icon - links to the original post</li>
                <li>🏷️ Comment type badges (POST, PAGE, AD, etc.)</li>
                <li>👆 Click any link to verify your replies are being received</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>📢 2. Facebook Page Comments & Ad Comments</h2>
        <p>Now fetches comments from page posts, visitor posts, AND advertisements</p>
        <button onclick="testFacebookCommentTypes()">Test Facebook Comment Types</button>
        <div id="facebook-test-result"></div>
        <div class="feature-demo">
            <strong>Enhanced Facebook Integration:</strong>
            <ul>
                <li>📝 <strong>Page Posts</strong>: Comments on your page's own posts</li>
                <li>👥 <strong>Visitor Posts</strong>: Comments on posts made by visitors to your page</li>
                <li>📺 <strong>Ad Comments</strong>: Comments on your Facebook advertisements (most important!)</li>
                <li>🔍 Better error handling for permissions and API limits</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>👥 3. Multiple Accounts Support</h2>
        <p>Connect multiple Facebook pages, Instagram accounts, and YouTube channels</p>
        <button onclick="testMultipleAccounts()">Test Multiple Accounts Feature</button>
        <div id="accounts-test-result"></div>
        <div class="feature-demo">
            <strong>Multi-Account Features:</strong>
            <ul>
                <li>🏷️ <strong>Account Names</strong>: Give custom names to your accounts (e.g., "Main Page", "Store Page")</li>
                <li>📊 <strong>Account Tracking</strong>: Each comment shows which account it came from</li>
                <li>⚡ <strong>Parallel Syncing</strong>: Syncs all connected accounts simultaneously</li>
                <li>🎛️ <strong>Individual Management</strong>: Disconnect specific accounts without affecting others</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>🧪 4. Integration Test</h2>
        <p>Test all features working together</p>
        <button onclick="testIntegration()">Run Full Integration Test</button>
        <div id="integration-test-result"></div>
    </div>

    <script src="api.js"></script>
    <script>
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="test-result ${type}">${message}</div>`;
        }

        function testCommentLinks() {
            try {
                const api = new SocialMediaAPI();
                
                // Test that comment structure includes link fields
                const sampleComment = {
                    id: 'test_123',
                    platform: 'facebook',
                    text: 'Test comment',
                    author: 'Test User',
                    commentUrl: 'https://facebook.com/comment/123',
                    postUrl: 'https://facebook.com/post/456',
                    type: 'ad_comment'
                };
                
                const hasRequiredFields = [
                    'commentUrl', 'postUrl', 'type'
                ].every(field => sampleComment.hasOwnProperty(field));
                
                if (hasRequiredFields) {
                    showResult('links-test-result', 
                        '✅ Comment link structure is properly implemented!<br>' +
                        '🔗 Comments will now show clickable links to original posts<br>' +
                        '📱 Users can verify replies directly on the platform<br>' +
                        '🏷️ Comment types (POST/PAGE/AD) are properly tagged', 'success');
                } else {
                    showResult('links-test-result', '❌ Comment link structure not found', 'error');
                }
            } catch (error) {
                showResult('links-test-result', `❌ Test failed: ${error.message}`, 'error');
            }
        }

        function testFacebookCommentTypes() {
            try {
                const api = new SocialMediaAPI();
                
                // Check if the fetch method includes multiple comment types
                const fetchMethod = api.fetchFacebookComments.toString();
                
                const hasPostComments = fetchMethod.includes('post_comment');
                const hasVisitorComments = fetchMethod.includes('visitor_comment') || fetchMethod.includes('visitor_posts');
                const hasAdComments = fetchMethod.includes('ad_comment') || fetchMethod.includes('adaccounts');
                
                let results = [];
                if (hasPostComments) results.push('✅ Page post comments');
                else results.push('❌ Page post comments missing');
                
                if (hasVisitorComments) results.push('✅ Visitor post comments');
                else results.push('❌ Visitor post comments missing');
                
                if (hasAdComments) results.push('✅ Advertisement comments');
                else results.push('❌ Advertisement comments missing');
                
                const allImplemented = hasPostComments && hasVisitorComments && hasAdComments;
                
                showResult('facebook-test-result', 
                    results.join('<br>') + '<br><br>' +
                    (allImplemented ? 
                        '<strong>🎉 All Facebook comment types are implemented!</strong><br>You will now see comments from posts, visitor posts, AND ads!' :
                        '<strong>⚠️ Some comment types may be missing</strong>'), 
                    allImplemented ? 'success' : 'error');
                    
            } catch (error) {
                showResult('facebook-test-result', `❌ Test failed: ${error.message}`, 'error');
            }
        }

        function testMultipleAccounts() {
            try {
                const api = new SocialMediaAPI();
                
                // Test new account structure
                const platformStatus = api.getPlatformStatus('facebook');
                const hasAccountsArray = Array.isArray(platformStatus.accounts);
                const hasAccountCount = typeof platformStatus.accountCount === 'number';
                
                // Test connection methods accept account names
                const connectMethod = api.connectFacebook.toString();
                const acceptsAccountName = connectMethod.includes('accountName');
                
                // Test platform status shows multiple accounts
                const statusMethod = api.getPlatformStatus.toString();
                const showsMultipleAccounts = statusMethod.includes('accountCount') && statusMethod.includes('connectedAccounts');
                
                let results = [];
                if (hasAccountsArray) results.push('✅ Account array structure');
                else results.push('❌ Account array structure missing');
                
                if (hasAccountCount) results.push('✅ Account counting');
                else results.push('❌ Account counting missing');
                
                if (acceptsAccountName) results.push('✅ Custom account naming');
                else results.push('❌ Custom account naming missing');
                
                if (showsMultipleAccounts) results.push('✅ Multiple account display');
                else results.push('❌ Multiple account display missing');
                
                const allImplemented = hasAccountsArray && hasAccountCount && acceptsAccountName && showsMultipleAccounts;
                
                showResult('accounts-test-result', 
                    results.join('<br>') + '<br><br>' +
                    (allImplemented ? 
                        '<strong>🎉 Multiple accounts support is fully implemented!</strong><br>You can now connect multiple Facebook pages, Instagram accounts, and YouTube channels!' :
                        '<strong>⚠️ Multiple accounts support may be incomplete</strong>'), 
                    allImplemented ? 'success' : 'error');
                    
            } catch (error) {
                showResult('accounts-test-result', `❌ Test failed: ${error.message}`, 'error');
            }
        }

        function testIntegration() {
            try {
                showResult('integration-test-result', '🧪 Running comprehensive integration test...', 'info');
                
                setTimeout(() => {
                    const api = new SocialMediaAPI();
                    let score = 0;
                    let maxScore = 8;
                    let details = [];
                    
                    // Test 1: API class loads
                    if (api && typeof api.connectFacebook === 'function') {
                        score++;
                        details.push('✅ API class loads correctly');
                    } else {
                        details.push('❌ API class failed to load');
                    }
                    
                    // Test 2: Multiple accounts structure
                    const status = api.getPlatformStatus('facebook');
                    if (Array.isArray(status.accounts)) {
                        score++;
                        details.push('✅ Multiple accounts structure');
                    } else {
                        details.push('❌ Multiple accounts structure missing');
                    }
                    
                    // Test 3: Enhanced Facebook integration
                    const fbFetch = api.fetchFacebookComments.toString();
                    if (fbFetch.includes('ad_comment') && fbFetch.includes('visitor_comment')) {
                        score++;
                        details.push('✅ Enhanced Facebook comment fetching');
                    } else {
                        details.push('❌ Enhanced Facebook integration incomplete');
                    }
                    
                    // Test 4: Comment link structure
                    if (fbFetch.includes('commentUrl') && fbFetch.includes('postUrl')) {
                        score++;
                        details.push('✅ Comment linking structure');
                    } else {
                        details.push('❌ Comment linking missing');
                    }
                    
                    // Test 5: Account naming
                    const connectFb = api.connectFacebook.toString();
                    if (connectFb.includes('accountName')) {
                        score++;
                        details.push('✅ Account naming support');
                    } else {
                        details.push('❌ Account naming missing');
                    }
                    
                    // Test 6: Error handling
                    if (connectFb.includes('console.error') && connectFb.includes('throw new Error')) {
                        score++;
                        details.push('✅ Enhanced error handling');
                    } else {
                        details.push('❌ Error handling needs improvement');
                    }
                    
                    // Test 7: Platform status for multiple accounts
                    const statusMethod = api.getPlatformStatus.toString();
                    if (statusMethod.includes('connectedAccounts') && statusMethod.includes('accountCount')) {
                        score++;
                        details.push('✅ Multi-account status tracking');
                    } else {
                        details.push('❌ Multi-account status incomplete');
                    }
                    
                    // Test 8: Disconnect functionality
                    const disconnectMethod = api.disconnectPlatform.toString();
                    if (disconnectMethod.includes('accountId')) {
                        score++;
                        details.push('✅ Individual account disconnect');
                    } else {
                        details.push('❌ Individual disconnect missing');
                    }
                    
                    const percentage = Math.round((score / maxScore) * 100);
                    const passGrade = percentage >= 75;
                    
                    showResult('integration-test-result', 
                        `<strong>Integration Test Results: ${score}/${maxScore} (${percentage}%)</strong><br><br>` +
                        details.join('<br>') + '<br><br>' +
                        (passGrade ? 
                            '<strong>🎉 PASS: All major features are implemented and ready for testing!</strong><br>' +
                            '<strong>🚀 You can now:</strong><br>' +
                            '• Connect multiple Facebook/Instagram/YouTube accounts<br>' +
                            '• See comments from posts, visitor posts, AND ads<br>' +
                            '• Click links to verify your replies on the original platform<br>' +
                            '• Track which account each comment belongs to' :
                            '<strong>⚠️ PARTIAL: Some features may need additional work</strong>'), 
                        passGrade ? 'success' : 'error');
                }, 500);
                
            } catch (error) {
                showResult('integration-test-result', `❌ Integration test failed: ${error.message}`, 'error');
            }
        }

        // Auto-run tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                testCommentLinks();
                testFacebookCommentTypes();
                testMultipleAccounts();
            }, 100);
        });
    </script>
</body>
</html>